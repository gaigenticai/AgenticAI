{% extends "base.html" %}

{% block title %}Generate Embeddings - {{ title }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold text-primary mb-3">
                    <i class="fas fa-brain me-3"></i>
                    Generate Embeddings
                </h1>
                <p class="lead text-muted">
                    Convert text into high-dimensional vector representations using FastEmbed's optimized models
                </p>
            </div>

            <!-- Main Form -->
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-edit me-2"></i>
                        Text Input
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form method="post" action="/generate-embeddings">
                        <div class="mb-4">
                            <label for="texts" class="form-label fw-bold">
                                Enter text to embed (one per line):
                            </label>
                            <textarea
                                class="form-control"
                                id="texts"
                                name="texts"
                                rows="8"
                                placeholder="Enter multiple texts here, one per line...

Example:
This is the first document about machine learning.
Another document discussing artificial intelligence.
A third text about natural language processing."
                                required
                            >{{ texts or '' }}</textarea>
                            <div class="form-text">
                                Each line will be converted to a separate embedding vector
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5" id="generateBtn">
                                <i class="fas fa-play me-2"></i>
                                Generate Embeddings
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            {% if result %}
            <div class="card shadow-lg mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-check-circle me-2"></i>
                        Embedding Results
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="h2 text-success mb-1">{{ result.embeddings|length }}</div>
                                <div class="text-muted">Embeddings Generated</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="h2 text-primary mb-1">{{ result.dimensions }}</div>
                                <div class="text-muted">Vector Dimensions</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="h2 text-info mb-1">{{ "%.2f"|format(result.model|length * 0.001) }}KB</div>
                                <div class="text-muted">Model Size</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">Model Information:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Model:</strong> {{ result.model }}
                            </div>
                            <div class="col-md-6">
                                <strong>Dimensions:</strong> {{ result.dimensions }}
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">Sample Embedding (First 10 dimensions):</h6>
                        <div class="code-block">
                            <pre>{{ result.embeddings[0][:10] | tojson(indent=2) }}</pre>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> Each text has been converted to a {{ result.dimensions }}-dimensional vector.
                        These vectors capture the semantic meaning of your text and can be used for similarity search.
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Error Section -->
            {% if error %}
            <div class="alert alert-danger mt-4" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> {{ error }}
            </div>
            {% endif %}

            <!-- Usage Examples -->
            <div class="card shadow-lg mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        Usage Examples
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">Single Document:</h6>
                            <div class="code-block mb-3">
This is a sample document about machine learning and artificial intelligence.
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">Multiple Documents:</h6>
                            <div class="code-block mb-3">
Machine learning is a subset of artificial intelligence.
Natural language processing helps computers understand human language.
Computer vision enables machines to interpret visual information.
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <strong>Tip:</strong> For best results, use clear, descriptive text that captures the essence of your content.
                        Avoid very short texts (less than 10 words) as they may not provide enough context for meaningful embeddings.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const generateBtn = document.getElementById('generateBtn');

    form.addEventListener('submit', function() {
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';

        // Re-enable after 10 seconds (in case of error)
        setTimeout(() => {
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-play me-2"></i>Generate Embeddings';
        }, 10000);
    });
});
</script>
{% endblock %}
